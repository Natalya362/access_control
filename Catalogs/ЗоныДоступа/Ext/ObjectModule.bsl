Процедура ПередЗаписью(Отказ)
	
	// Пропускаем проверку, если запись уже отменена
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	// Проверка обязательного поля Наименование
	Если Не ЗначениеЗаполнено(ЭтотОбъект.Наименование) Тогда
		Сообщить("Поле Наименование не заполнено!");
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	
	// Проверка уникальности наименования
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ ПЕРВЫЕ 1
		|	ЗоныДоступа.Ссылка
		|ИЗ
		|	Справочник.ЗоныДоступа КАК ЗоныДоступа
		|ГДЕ
		|	ЗоныДоступа.Наименование = &Наименование
		|	И ЗоныДоступа.Ссылка <> &ТекущаяСсылка
		|	И НЕ ЗоныДоступа.ПометкаУдаления";
	
	Запрос.УстановитьПараметр("Наименование", ЭтотОбъект.Наименование);
	Запрос.УстановитьПараметр("ТекущаяСсылка", ЭтотОбъект.Ссылка);
	
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Сообщить("Зона доступа с наименованием """ + ЭтотОбъект.Наименование + """ уже существует!");
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	
	// Автоматическое заполнение кода, если он пустой
	Если Не ЗначениеЗаполнено(ЭтотОбъект.Код) Тогда
		Запрос = Новый Запрос;
		Запрос.Текст = 
			"ВЫБРАТЬ
			|	ЗоныДоступа.Код
			|ИЗ
			|	Справочник.ЗоныДоступа КАК ЗоныДоступа
			|ГДЕ
			|	НЕ ЗоныДоступа.ПометкаУдаления";
		
		Результат = Запрос.Выполнить();
		Выборка = Результат.Выбрать();
		
		МаксКод = 0;
		Пока Выборка.Следующий() Цикл
			// Пытаемся преобразовать код в число, игнорируя некорректные значения
			Попытка
				ТекКод = Число(Выборка.Код);
				МаксКод = Макс(МаксКод, ТекКод);
			Исключение
				// Игнорируем некорректные значения
				Продолжить;
			КонецПопытки;
		КонецЦикла;
		
		ЭтотОбъект.Код = Формат(МаксКод + 1, "ЧЦ=9; ЧВН=; ЧГ=0");
		
	КонецЕсли;
	
	// Проверка уникальности кода
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ ПЕРВЫЕ 1
		|	ЗоныДоступа.Ссылка
		|ИЗ
		|	Справочник.ЗоныДоступа КАК ЗоныДоступа
		|ГДЕ
		|	ЗоныДоступа.Код = &Код
		|	И ЗоныДоступа.Ссылка <> &ТекущаяСсылка
		|	И НЕ ЗоныДоступа.ПометкаУдаления";
	
	Запрос.УстановитьПараметр("Код", ЭтотОбъект.Код);
	Запрос.УстановитьПараметр("ТекущаяСсылка", ЭтотОбъект.Ссылка);
	
	Результат = Запрос.Выполнить();
	Если Не Результат.Пустой() Тогда
		Сообщить("Зона доступа с кодом """ + ЭтотОбъект.Код + """ уже существует!");
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	
КонецПроцедуры