&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
    // Установка значений по умолчанию для дат (последний месяц)
    ДатаОкончания = КонецДня(ТекущаяДата()); // 27.07.2025
    ДатаНачала = НачалоДня(ДобавитьМесяц(ТекущаяДата(), -1)); // 27.06.2025
    
    // Инициализация диаграммы
    ОбновитьДиаграммуНаСервере();
КонецПроцедуры

&НаСервере
Процедура ОбновитьДиаграммуНаСервере()
    ДиаграммаПосещений.Очистить();
    
    // Получение данных из отчета
    ТаблицаДиаграммы = Отчеты.ЖурналПосещений.ПолучитьДанныеДляДиаграммы(ДатаНачала, ДатаОкончания);
    
    Если ТаблицаДиаграммы = Неопределено Или ТаблицаДиаграммы.Количество() = 0 Тогда
        Сообщить("Нет данных для построения диаграммы за период с " + Формат(ДатаНачала, "ДФ='dd.MM.yyyy'") + " по " + Формат(ДатаОкончания, "ДФ='dd.MM.yyyy'"));
        Возврат;
    КонецЕсли;
    
    // Настройка диаграммы
    ДиаграммаПосещений.ТипДиаграммы = ТипДиаграммы.Гистограмма;
    ДиаграммаПосещений.Заголовок = "Посещения по дням";
    ДиаграммаПосещений.ОтображатьЗаголовок = Истина;
    
    Серия = ДиаграммаПосещений.Серии.Add("Количество посещений");
    Серия.Цвет = WebЦвета.Синий;
    
    Для Каждого Строка Из ТаблицаДиаграммы Цикл
        Точка = ДиаграммаПосещений.Точки.Add(Формат(Строка.Дата, "ДФ='dd.MM.yyyy'"));
        ДиаграммаПосещений.УстановитьЗначение(Точка, Серия, Строка.КоличествоПосещений);
    КонецЦикла;
    
    ДиаграммаПосещений.ОбластьПостроения.ОсьЗначений.Заголовок = "Количество посещений";
    ДиаграммаПосещений.ОбластьПостроения.ОсьЗначений.ОтображатьЗаголовок = Истина;
    ДиаграммаПосещений.ОбластьПостроения.ОсьКатегорий.Заголовок = "Дата";
    ДиаграммаПосещений.ОбластьПостроения.ОсьКатегорий.ОтображатьЗаголовок = Истина;
    ДиаграммаПосещений.ОбластьПостроения.ОтображатьПодписиТочек = Истина;
    ДиаграммаПосещений.ОбластьПостроения.ОтображатьЛинииСетки = Истина;
КонецПроцедуры

&НаКлиенте
Процедура ОбновитьДиаграмму(Команда)
    ОбновитьДиаграммуНаСервере();
КонецПроцедуры

&НаКлиенте
Процедура ДатаНачалаПриИзменении(Элемент)
    ОбновитьДиаграммуНаСервере();
КонецПроцедуры

&НаКлиенте
Процедура ДатаОкончанияПриИзменении(Элемент)
    ОбновитьДиаграммуНаСервере();
КонецПроцедуры