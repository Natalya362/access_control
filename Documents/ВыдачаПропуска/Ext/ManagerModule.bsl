Процедура ПечатьПропуска(ТабДок, Ссылка) Экспорт
    // Получение макета печатной формы
    Макет = Документы.ВыдачаПропуска.ПолучитьМакет("ПечатнаяФормаПропуска");
    
    // Формирование запроса
    Запрос = Новый Запрос;
    Запрос.Текст =
    "ВЫБРАТЬ
    |	ВыдачаПропуска.Заявка.РежимноеПомещение КАК РежимноеПомещение,
    |	ВыдачаПропуска.Дата КАК Дата,
    |	ВыдачаПропуска.ДатаВыдачи КАК ДатаВыдачи,
    |	ВыдачаПропуска.ДатаОкончания КАК ДатаОкончания,
    |	ВыдачаПропуска.ЗонаДоступа КАК ЗонаДоступа,
    |	ВыдачаПропуска.Инициатор КАК Инициатор,
    |	ВыдачаПропуска.ФизическоеЛицо КАК ФизическоеЛицо,
    |	ВыдачаПропуска.ПричиныПосещения КАК ПричиныПосещения,
    |	ВыдачаПропуска.ТипПропуска КАК ТипПропуска,
    |	ВыдачаПропуска.ТочкаКонтроля КАК ТочкаКонтроля,
    |	ВыдачаПропуска.Номер КАК Номер
    |ИЗ
    |	Документ.ВыдачаПропуска КАК ВыдачаПропуска
    |ГДЕ
    |	ВыдачаПропуска.Ссылка В(&Ссылка)";
    
    Запрос.УстановитьПараметр("Ссылка", Ссылка);
    
    // Выполнение запроса
    Результат = Запрос.Выполнить();
    
    // Проверка на пустой результат
    Если Результат.Пустой() Тогда
        Сообщить("Нет данных для печати пропуска.", СтатусСообщения.Важное);
        Возврат;
    КонецЕсли;
    
    Выборка = Результат.Выбрать();
    
    // Получение областей макета
    Заголовок = Макет.ПолучитьОбласть("Заголовок");
    Шапка = Макет.ПолучитьОбласть("Шапка");
    
    // Очистка табличного документа
    ТабДок.Очистить();
    
    ВставлятьРазделительСтраниц = Ложь;
    Пока Выборка.Следующий() Цикл
        Если ВставлятьРазделительСтраниц Тогда
            ТабДок.ВывестиГоризонтальныйРазделительСтраниц();
        КонецЕсли;
        
        // Форматирование дат с учетом возможных пустых значений
        Заголовок.Параметры.Дата = ?(ЗначениеЗаполнено(Выборка.Дата), 
            Формат(Выборка.Дата, "ДЛФ=DD"), "");
        Шапка.Параметры.ДатаВыдачи = ?(ЗначениеЗаполнено(Выборка.ДатаВыдачи), 
            Формат(Выборка.ДатаВыдачи, "ДЛФ=DD"), "");
        Шапка.Параметры.ДатаОкончания = ?(ЗначениеЗаполнено(Выборка.ДатаОкончания), 
            Формат(Выборка.ДатаОкончания, "ДЛФ=DD"), "");
        
        // Заполнение параметров с проверкой на null
        Заголовок.Параметры.Номер = Строка(Выборка.Номер);
        Заголовок.Параметры.РежимноеПомещение = ?(ЗначениеЗаполнено(Выборка.РежимноеПомещение), 
            Выборка.РежимноеПомещение, "");
        Заголовок.Параметры.ТипПропуска = ?(ЗначениеЗаполнено(Выборка.ТипПропуска), 
            Выборка.ТипПропуска, "");
        
        Шапка.Параметры.Инициатор = ?(ЗначениеЗаполнено(Выборка.Инициатор), 
            Выборка.Инициатор, "");
        Шапка.Параметры.ФизическоеЛицо = ?(ЗначениеЗаполнено(Выборка.ФизическоеЛицо), 
            Выборка.ФизическоеЛицо, "");
        Шапка.Параметры.ПричиныПосещения = ?(ЗначениеЗаполнено(Выборка.ПричиныПосещения), 
            Выборка.ПричиныПосещения, "");
        Шапка.Параметры.ЗонаДоступа = ?(ЗначениеЗаполнено(Выборка.ЗонаДоступа), 
            Выборка.ЗонаДоступа, "");
        Шапка.Параметры.ТочкаКонтроля = ?(ЗначениеЗаполнено(Выборка.ТочкаКонтроля), 
            Выборка.ТочкаКонтроля, "");
        
        // Вывод областей в табличный документ
        ТабДок.Вывести(Заголовок);
        ТабДок.Вывести(Шапка);
        
        ВставлятьРазделительСтраниц = Истина;
    КонецЦикла;
    
    // Настройки отображения
    ТабДок.АвтоМасштаб = Истина;
    ТабДок.ОриентацияСтраницы = ОриентацияСтраницы.Портрет;
    ТабДок.ТолькоПросмотр = Истина;
    ТабДок.ОтображатьСетку = Ложь;
    ТабДок.ОтображатьЗаголовки = Ложь;
    
КонецПроцедуры