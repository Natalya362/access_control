&НаКлиенте
Процедура ЗаявкаПриИзменении(Элемент)
	ЗаполнитьДанныеИзЗаявкиНаСервере();
	ОбновитьОтображениеДанных();
	Элементы.Инициатор.Обновить();
	Элементы.ФизическоеЛицо.Обновить();
	Элементы.ТипПропуска.Обновить();
	Элементы.ЗонаДоступа.Обновить();
КонецПроцедуры

&НаКлиенте
Процедура ПослеЗаписи(ПараметрыЗаписи)
    ОбновитьОтображениеДанных();
    Элементы.Инициатор.Обновить();
    Элементы.ФизическоеЛицо.Обновить();
    Элементы.ТипПропуска.Обновить();
    Элементы.ЗонаДоступа.Обновить();
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьДанныеИзЗаявкиНаСервере()
	Если ЗначениеЗаполнено(Объект.Заявка) Тогда
		Запрос = Новый Запрос;
		Запрос.Текст = 
		"ВЫБРАТЬ
		|	ЗаявкаНаПропуск.Инициатор КАК Инициатор,
		|	ЗаявкаНаПропуск.Посетитель КАК Посетитель,
		|	ЗаявкаНаПропуск.ТипПропуска КАК ТипПропуска,
		|	ЗаявкаНаПропуск.ЗонаДоступа КАК ЗонаДоступа
		|ИЗ
		|	Документ.ЗаявкаНаПропуск КАК ЗаявкаНаПропуск
		|ГДЕ
		|	ЗаявкаНаПропуск.Ссылка = &Заявка";
		Запрос.УстановитьПараметр("Заявка", Объект.Заявка);
		Результат = Запрос.Выполнить();
		
		Если Не Результат.Пустой() Тогда
			Выборка = Результат.Выбрать();
			Выборка.Следующий();
			
			Сообщить("Данные из заявки перед заполнением:");
			Сообщить("  Инициатор: " + ?(ЗначениеЗаполнено(Выборка.Инициатор), Выборка.Инициатор, "Пусто"));
			Сообщить("  Посетитель: " + ?(ЗначениеЗаполнено(Выборка.Посетитель), Выборка.Посетитель, "Пусто"));
			Сообщить("  ТипПропуска: " + ?(ЗначениеЗаполнено(Выборка.ТипПропуска), Выборка.ТипПропуска, "Пусто"));
			Сообщить("  ЗонаДоступа: " + ?(ЗначениеЗаполнено(Выборка.ЗонаДоступа), Выборка.ЗонаДоступа, "Пусто"));
			
			Объект.Ответственный = Выборка.Инициатор;
			Объект.Посетитель = Выборка.Посетитель;
			Объект.ТипПропуска = Выборка.ТипПропуска;
			
			// Обработка ЗоныДоступа как табличной части
			Если ТипЗнч(Объект.ЗоныДоступа) = Тип("ДанныеФормыКоллекция") Тогда
				Объект.ЗоныДоступа.Очистить();
				Если ЗначениеЗаполнено(Выборка.ЗонаДоступа) Тогда
					НоваяСтрока = Объект.ЗоныДоступа.Добавить();
					НоваяСтрока.ЗонаДоступа = Выборка.ЗонаДоступа; // Предполагаем, что колонка называется ЗонаДоступа
				КонецЕсли;
			Иначе
				Объект.ЗоныДоступа = Выборка.ЗонаДоступа;
			КонецЕсли;
			
			Сообщить("Заполнение данных из заявки " + Объект.Заявка + " в форме:");
			Сообщить("  Ответственный (Инициатор): " + ?(ЗначениеЗаполнено(Объект.Заявка.Инициатор), Объект.Заявка.Инициатор, "Не заполнено"));
			Сообщить("  Посетитель: " + ?(ЗначениеЗаполнено(Объект.Заявка.ФизическоеЛицо), Объект.Посетитель, "Не заполнено"));
			Сообщить("  ТипПропуска: " + ?(ЗначениеЗаполнено(Объект.Заявка.ТипПропуска), Объект.ТипПропуска, "Не заполнено"));
			Сообщить("  ЗоныДоступа: " + ?(ЗначениеЗаполнено(Объект.Заявка.ЗонаДоступа), Объект.ЗоныДоступа, "Не заполнено"));
		Иначе
			Сообщить("Не удалось получить данные из заявки " + Объект.Заявка + ". Проверьте корректность ссылки.");
		КонецЕсли;
	Иначе
		Объект.Заявка.Инициатор = Справочники.Сотрудники.ПустаяСсылка();
		Объект.Заявка.ФизическоеЛицо = Справочники.Посетители.ПустаяСсылка();
		Объект.Заявка.ТипПропуска = Справочники.ТипыПропусков.ПустаяСсылка();
		Объект.Заявка.ЗонаДоступа = Выборка.ЗонаДоступа;
		Сообщить("Заявка не заполнена!");
	КонецЕсли;
КонецПроцедуры